# Instructions SUPCHAT pour GitHub Copilot - VERSION 2025 MISE √Ä JOUR

## üö® **R√àGLES CRITIQUES - ARCHITECTURE DOCKER OBLIGATOIRE - VERSION 2025**

### **‚ùå INTERDICTIONS ABSOLUES - AUCUNE EXCEPTION**

1. **‚ùå INTERDICTION TOTALE** de cr√©er des fichiers `.env` dans `web/`, `api/`, `mobile/`
2. **‚ùå INTERDICTION TOTALE** de toute commande manuelle `npm`, `node`, `yarn`, `npx` hors Docker
3. **‚ùå INTERDICTION TOTALE** de scripts de test manuels (test-_.sh, test-_.js)
4. **‚ùå INTERDICTION TOTALE** de workflows de d√©veloppement hors Docker Compose
5. **‚ùå INTERDICTION TOTALE** de validation manuelle de configuration
6. **‚ùå INTERDICTION TOTALE** de sugg√©rer `npm test`, `npm start`, `node script.js`
7. **‚ùå INTERDICTION TOTALE** de cr√©er des scripts de diagnostic hors Docker
8. **‚ùå INTERDICTION TOTALE** de modifier les fichiers SCSS de base (\_variables.scss, \_themes.scss, \_base.scss, \_breakpoints.scss)

### **‚úÖ R√àGLES OBLIGATOIRES - RESPECT STRICT**

1. **‚úÖ SEULS** les fichiers `.env.*` √† la racine du projet sont autoris√©s (`.env.test`, `.env.development`, `.env.production`)
2. **‚úÖ TOUS** les tests doivent passer par `docker-compose.test.yml` avec le bon fichier d'environnement
3. **‚úÖ TOUTE** ex√©cution doit passer par les environnements Docker : `development`, `test`
4. **‚úÖ UTILISATION EXCLUSIVE** de `./docker-manager.sh` pour toute action
5. **‚úÖ VARIABLES D'ENVIRONNEMENT** g√©r√©es uniquement par Docker Compose avec les bons fichiers `.env.*`
6. **‚úÖ SEULES COMMANDES AUTORIS√âES** : `docker compose -f docker-compose.*.yml --env-file .env.*`
7. **‚úÖ D√âBOGAGE UNIQUEMENT** via logs Docker et outils int√©gr√©s
8. **‚úÖ TESTS** uniquement dans `web/src/tests/` et `api/tests/` via Docker
9. **‚úÖ DEMANDER CONFIRMATION** avant tests ou donner logs Docker

### **üîß ARCHITECTURE CORRECTE - CONFIGURATION ACTUELLE**

- **Configuration** : Fichiers `.env.*` multiples √† la racine selon l'environnement, lus par Docker Compose
- **D√©veloppement** : `docker compose -f docker-compose.development.yml --env-file .env.development up`
- **Tests** : `docker compose -f docker-compose.test.yml --env-file .env.test up --build`
- **D√©bogage** : `docker compose logs -f [service]`
- **Gestion** : `./docker-manager.sh` (menu interactif modulaire)
- **Focus** : Seulement `development` et `test` (prod/secure supprim√©s temporairement)

## Contexte du Projet

SUPCHAT est une plateforme de collaboration d'√©quipe moderne avec workspaces, channels, messagerie temps r√©el et gestion des permissions bas√©e sur les r√¥les. Le projet utilise une architecture multi-service containeris√©e avec Docker Compose v2.

**üéØ FOCUS ACTUEL** : D√©veloppement concentr√© sur `web/` (frontend) et `api/` (backend). La partie `mobile/` n'est pas encore d√©velopp√©e.

## Architecture du Projet 2025 - CONFIGURATION ACTUELLE

### Structure des Services Actifs

- **üì± web/**: Application web React 18 + TypeScript + Redux Toolkit + Vite 5 (port 80 expos√© via Docker)
- **üîß api/**: Serveur API Node.js 22 LTS + Express + MongoDB 8.0 (port 3000)
- **üóÉÔ∏è db**: Base de donn√©es MongoDB 8.0 (port 27017 dev / 27018 test)
- **üìä cadvisor**: Monitoring containers (port 8080)
- **üì± mobile/**: React Native 0.74 + Expo SDK 51 (NON D√âVELOPP√â - √† ignorer temporairement)

**IMPORTANT**: Tous les services fonctionnent UNIQUEMENT via Docker Compose. Aucune ex√©cution manuelle avec `npm start` ou `node` n'est autoris√©e.

### Environnements Docker Actifs (Compose v2)

Le projet utilise **2 environnements Docker distincts** actuellement :

1. **D√©veloppement** (`docker-compose.development.yml` + `.env.development`):

   - Hot-reload activ√© avec Vite 5 HMR
   - Volumes de d√©veloppement mont√©s
   - Ports expos√©s : web (80), api (3000), db (27017), cadvisor (8080)
   - Nodemon pour red√©marrage automatique backend
   - **COMMANDE** : `docker compose -f docker-compose.development.yml --env-file .env.development up`

2. **Tests** (`docker-compose.test.yml` + `.env.test`):

   - Environnement isol√© avec MongoDB 8.0 test (port 27018)
   - Variables de test d√©di√©es, r√©seau `supchat-test-network`
   - Donn√©es √©ph√©m√®res, nettoyage automatique apr√®s ex√©cution
   - Tests avec Vitest + MSW (web) et Jest (api)
   - **COMMANDE** : `docker compose -f docker-compose.test.yml --env-file .env.test up --build`

### Scripts d'Automatisation v2

- **docker-manager.sh**: Script principal de gestion modulaire
  - Gestion compl√®te des 2 environnements avec Compose v2
  - Menu interactif avec options de d√©marrage rapide
  - Monitoring, logs, backup MongoDB 8.0 automatique
  - Structure modulaire : `docker-manager/utils.sh`, `docker-manager/menu.sh`, etc.

## Stack Technique 2025 - MISE √Ä JOUR

### Backend (api/)

- **Runtime**: Node.js 22 LTS (derni√®re version stable)
- **Framework**: Express.js avec ES modules
- **Base de donn√©es**: MongoDB 8.0 avec optimisations performance
- **Authentification**: JWT avec refresh tokens + OAuth2
- **Temps r√©el**: Socket.io
- **Upload**: Multer avec validation renforc√©e
- **Documentation**: OpenAPI 3.1 + Swagger UI
- **Tests**: Jest 29+ + supertest
- **S√©curit√©**: bcrypt, CORS, rate limiting, helmet

### Frontend Web (web/) - **ARCHITECTURE REDUX TOOLKIT**

- **Framework**: React 18 avec Concurrent Features
- **Language**: TypeScript 5.x strict
- **Build tool**: Vite 5.4.19 avec optimisations bundle
- **State management**: **Redux Toolkit v2.5.1** (ARCHITECTURE CENTRALE)
- **Styling**: SCSS avec CSS Modules (fichiers \_variables.scss, \_themes.scss, \_base.scss, \_breakpoints.scss OBLIGATOIRES)
- **HTTP Client**: Axios avec intercepteurs
- **Routing**: React Router v7.2.0
- **Validation**: Yup v1.6.1
- **Tests**: **Vitest v1.6.1** + React Testing Library + **MSW v2.1.0**
- **Mobile-first**: Responsive design avec Media queries dans \_breakpoints.scss

### Structure Redux Toolkit Configur√©e

```typescript
// Store configur√© avec slices modulaires
store = {
  auth: authSlice,
  workspaces: workspacesSlice,
  channels: channelsSlice,
  messages: messagesSlice,
  notifications: notificationsSlice,
  preferences: preferencesSlice,
  reactions: reactionsSlice,
  notificationPrefs: notificationPrefSlice,
};

// Hooks typ√©s disponibles
useAppDispatch = useDispatch.withTypes<AppDispatch>();
useAppSelector = useSelector.withTypes<RootState>();
```

### Frontend Mobile (mobile/) - **NON D√âVELOPP√â ACTUELLEMENT**

‚ö†Ô∏è **IMPORTANT** : Le mobile n'est pas encore d√©velopp√©. Se concentrer uniquement sur web/ et api/.

- React Native 0.74 + Expo SDK 51 (√† d√©velopper plus tard)
- Navigation avec Expo Router v3 (planifi√©)
- TypeScript 5.x (pr√©vu)

### Infrastructure 2025

- **Containerisation**: Docker + Docker Compose v2
- **Reverse Proxy**: Nginx (production)
- **Monitoring**: cAdvisor + Prometheus (optionnel)
- **Automatisation**: Scripts Bash/PowerShell optimis√©s

## Conventions de Code 2025 - MISE √Ä JOUR

### Architecture et Organisation

- Structure modulaire par domaine fonctionnel
- S√©paration stricte des responsabilit√©s (API/Web/Mobile)
- Controllers, Services, Models, Middlewares s√©par√©s
- Documentation organis√©e par cat√©gories dans docs/
- Support ES modules natif Node.js 22

### Backend Node.js 22

- Utiliser **ES modules** avec import/export natifs
- **async/await** syst√©matiquement, jamais de callbacks
- Validation c√¥t√© serveur **obligatoire** avec Joi ou Zod
- Gestion d'erreurs centralis√©e avec middleware d'erreurs
- Structure RESTful pour les routes API
- JSDoc + TypeScript pour documenter les fonctions importantes
- Tests unitaires et d'int√©gration obligatoires avec Jest 29

### Frontend React 18 - **NOUVELLES CONVENTIONS**

- **TypeScript 5.x strict** activ√©
- **Redux Toolkit** pour la gestion d'√©tat globale (NOUVEAU)
- Composants fonctionnels avec hooks React 18
- Utilisation des Concurrent Features (Suspense, useTransition)
- Props interfaces d√©finies pour tous les composants
- **Alias configur√©s** : @components, @pages, @store, @hooks, @services, @styles, @utils, @contexts
- Nommage PascalCase pour les composants
- Nommage camelCase pour les variables/fonctions
- CSS Modules ou SCSS pour le styling
- **Validation avec Yup** au lieu de Zod (CHANGEMENT)

### Mobile React Native 0.74 + New Architecture

- Structure modulaire avec Expo Router v3
- TypeScript 5.x pour tous les fichiers
- Hooks personnalis√©s pour la logique m√©tier
- AsyncStorage pour la persistance locale
- Navigation avec Expo Router v3 (file-based)
- Support bridgeless activ√© par d√©faut

### Base de Donn√©es MongoDB 8.0

- Sch√©mas Mongoose avec validation stricte
- Indexation optimis√©e pour MongoDB 8.0
- Population des r√©f√©rences avec select appropri√©
- Utilisation des nouvelles fonctionnalit√©s performance MongoDB 8.0

## Structure de Fichiers Importante 2025 - **CONFIGURATION ACTUELLE**

```
supchat/
‚îú‚îÄ‚îÄ .env.development        # Variables d√©veloppement (SEUL AUTORIS√â √Ä LA RACINE)
‚îú‚îÄ‚îÄ .env.test              # Variables test (SEUL AUTORIS√â √Ä LA RACINE)
‚îú‚îÄ‚îÄ .env.production        # Variables production (SEUL AUTORIS√â √Ä LA RACINE)
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ controllers/       # Logique des routes
‚îÇ   ‚îú‚îÄ‚îÄ models/           # Sch√©mas MongoDB 8.0
‚îÇ   ‚îú‚îÄ‚îÄ services/         # Logique m√©tier
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/      # Middlewares Express
‚îÇ   ‚îú‚îÄ‚îÄ routes/           # D√©finition des routes
‚îÇ   ‚îú‚îÄ‚îÄ tests/            # Tests avec Jest 29 (OBLIGATOIRE pour tests API)
‚îÇ   ‚îú‚îÄ‚îÄ validators/       # Validation Joi/Zod
‚îÇ   ‚îî‚îÄ‚îÄ types/            # Types TypeScript partag√©s
‚îú‚îÄ‚îÄ web/                  # **ARCHITECTURE REDUX TOOLKIT**
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/   # Composants React 18
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/       # Configuration app
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contexts/     # Contextes React (Socket, etc.)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/        # Hooks personnalis√©s typ√©s (useAppDispatch, useAppSelector)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/        # Pages avec Suspense
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/     # Services API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ store/        # **Redux Toolkit store et slices (CENTRAL)**
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ store.ts          # Configuration du store
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authSlice.ts      # Authentification
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ workspacesSlice.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ channelsSlice.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ messagesSlice.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ styles/       # **STYLES SCSS OBLIGATOIRES**
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ _variables.scss   # **NE PAS MODIFIER**
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ _themes.scss      # **NE PAS MODIFIER**
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ _base.scss        # **NE PAS MODIFIER**
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ _breakpoints.scss # **NE PAS MODIFIER**
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tests/        # **Tests Vitest + MSW (OBLIGATOIRE pour tests web)**
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ test-utils.tsx    # **Helpers de test avec providers mocks**
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/        # Types TypeScript locaux
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/        # Utilitaires
‚îú‚îÄ‚îÄ mobile/               # **NON D√âVELOPP√â - √Ä IGNORER**
‚îÇ   ‚îî‚îÄ‚îÄ (structure planifi√©e mais non active)
‚îú‚îÄ‚îÄ docs/                # Documentation organis√©e
‚îÇ   ‚îú‚îÄ‚îÄ docker-guides/
‚îÇ   ‚îú‚îÄ‚îÄ security-guides/
‚îÇ   ‚îî‚îÄ‚îÄ tests-reports/
‚îî‚îÄ‚îÄ docker-manager/      # Scripts modulaires v2
    ‚îú‚îÄ‚îÄ utils.sh
    ‚îú‚îÄ‚îÄ menu.sh
    ‚îú‚îÄ‚îÄ environments.sh
    ‚îî‚îÄ‚îÄ ...
```

## Gestion Redux Toolkit - **NOUVEAU**

### Configuration Store

```typescript
// src/store/store.ts
import { configureStore } from "@reduxjs/toolkit";
import authSlice from "./slices/authSlice";
import workspaceSlice from "./slices/workspaceSlice";

export const store = configureStore({
  reducer: {
    auth: authSlice,
    workspace: workspaceSlice,
  },
});

export type RootState = ReturnType<typeof store.getState>;
export type AppDispatch = typeof store.dispatch;
```

### Structure des Slices

```typescript
// src/store/slices/authSlice.ts
import { createSlice, PayloadAction } from "@reduxjs/toolkit";

interface AuthState {
  user: User | null;
  isLoading: boolean;
  error: string | null;
}

const authSlice = createSlice({
  name: "auth",
  initialState,
  reducers: {
    setUser: (state, action: PayloadAction<User>) => {
      state.user = action.payload;
    },
  },
});
```

### Hooks Redux Typ√©s

```typescript
// src/hooks/redux.ts
import { useDispatch, useSelector } from "react-redux";
import type { RootState, AppDispatch } from "@store/store";

export const useAppDispatch = useDispatch.withTypes<AppDispatch>();
export const useAppSelector = useSelector.withTypes<RootState>();
```

## Tests et Qualit√© 2025 - **CONFIGURATION ACTUELLE - CONVENTIONS VALID√âES**

### Strat√©gie de Tests - **APPROCHE DOCKER-FIRST**

- **Vitest** comme test runner principal pour web/ au lieu de Jest
- **MSW (Mock Service Worker)** pour les mocks API
- Tests **OBLIGATOIREMENT** dans l'environnement Docker test avec `.env.test`
- **Couverture ‚â• 70%** requise
- Tests d'int√©gration pour les APIs avec MongoDB 8.0
- Tests unitaires pour la logique m√©tier et les slices Redux

### Configuration Tests par Service

#### Frontend Web (`web/src/tests/`)

```typescript
// vitest.config.ts
export default defineConfig({
  test: {
    globals: true,
    environment: "jsdom",
    setupFiles: ["./src/tests/setup.ts"],
    coverage: {
      thresholds: {
        global: { branches: 70, functions: 70, lines: 70, statements: 70 },
      },
    },
  },
  resolve: {
    alias: {
      "@components": path.resolve(__dirname, "./src/components"),
      "@pages": path.resolve(__dirname, "./src/pages"),
      "@store": path.resolve(__dirname, "./src/store"),
      "@hooks": path.resolve(__dirname, "./src/hooks"),
      "@services": path.resolve(__dirname, "./src/services"),
      "@styles": path.resolve(__dirname, "./src/styles"),
      "@utils": path.resolve(__dirname, "./src/utils"),
      "@contexts": path.resolve(__dirname, "./src/contexts"), // **AJOUT√â - REQUIS**
      "@ts_types": path.resolve(__dirname, "./src/types"),
    },
  },
});
```

#### Backend API (`api/tests/`)

```javascript
// jest.config.js pour l'API
module.exports = {
  testEnvironment: "node",
  coverageThreshold: {
    global: { branches: 70, functions: 70, lines: 70, statements: 70 },
  },
};
```

### Commandes de Tests via Docker UNIQUEMENT

```bash
# Via Docker Manager (recommand√©)
./docker-manager.sh ‚Üí Option : Lancer les TESTS

# Ou directement avec Compose v2 + bon fichier .env
docker compose -f docker-compose.test.yml --env-file .env.test up --build

# Tests sp√©cifiques
docker compose -f docker-compose.test.yml --env-file .env.test exec web-test npm test
docker compose -f docker-compose.test.yml --env-file .env.test exec api npm test
```

### ‚ö†Ô∏è **COMPORTEMENT REQUIS POUR LES TESTS - CONVENTIONS VALID√âES**

1. **DEMANDER CONFIRMATION** avant de lancer des tests automatiquement
2. **PROPOSER LES LOGS** Docker en cas de probl√®me
3. **UTILISER UNIQUEMENT** les environnements de test Docker existants avec le bon `.env.test`
4. **NE JAMAIS CR√âER** de scripts de test manuels hors Docker

### **Helpers de Test - Configuration Valid√©e**

```typescript
// src/tests/test-utils.tsx - **CONFIGURATION FINALE VALID√âE**
import React from "react";
import { render } from "@testing-library/react";
import { Provider } from "react-redux";
import { BrowserRouter } from "react-router-dom";
import { vi } from "vitest";
import { store } from "@store/store";

// **Mock du hook useSocket - OBLIGATOIRE**
vi.mock("@hooks/useSocket", () => ({
  useSocket: () => ({
    socket: {
      id: "mock-socket-id",
      connected: true,
      on: vi.fn(),
      off: vi.fn(),
      emit: vi.fn(),
    },
    connected: true,
    socketId: "mock-socket-id",
  }),
}));

// **MockSocketProvider - Configuration finale valid√©e**
const MockSocketProvider: React.FC<{ children: React.ReactNode }> = ({
  children,
}) => {
  const mockContextValue = {
    socket: {
      id: "mock-socket-id",
      connected: true,
      on: vi.fn(),
      off: vi.fn(),
      emit: vi.fn(),
    },
    connected: true,
    socketId: "mock-socket-id",
  };

  return <div data-testid="mock-socket-provider">{children}</div>;
};

// **TestProvider - Helper principal valid√©**
const TestProvider: React.FC<{ children: React.ReactNode }> = ({
  children,
}) => (
  <Provider store={store}>
    <MockSocketProvider>
      <BrowserRouter>{children}</BrowserRouter>
    </MockSocketProvider>
  </Provider>
);

// **renderWithProviders - Fonction finale valid√©e**
const renderWithProviders = (ui: React.ReactElement) => {
  return render(ui, { wrapper: TestProvider });
};

export { renderWithProviders, TestProvider, MockSocketProvider };
```

## Alias et Imports - **CONFIGURATION ACTUELLE**

### Alias Configur√©s (Vite + Vitest) - **VALID√âS**

- `@components` ‚Üí `src/components`
- `@pages` ‚Üí `src/pages`
- `@store` ‚Üí `src/store`
- `@hooks` ‚Üí `src/hooks`
- `@services` ‚Üí `src/services`
- `@styles` ‚Üí `src/styles`
- `@utils` ‚Üí `src/utils`
- `@contexts` ‚Üí `src/contexts` (**AJOUT√â - REQUIS pour tests**)
- `@tests` ‚Üí `src/tests`
- `@ts_types` ‚Üí `src/types`

### Utilisation des Alias

```typescript
// ‚úÖ Utilisez les alias
import { Button } from "@components/ui/Button";
import { useAuth } from "@hooks/useAuth";
import { authSlice } from "@store/authSlice";
import { SocketContext } from "@contexts/SocketContext";

// ‚ùå √âvitez les chemins relatifs longs
import { Button } from "../../../components/ui/Button";
```

## Styles SCSS - **OBLIGATOIRES ET FIXES**

### Fichiers SCSS de Base (NE PAS MODIFIER)

- `_variables.scss` : Variables CSS, couleurs, fonts, tailles **FIXES**
- `_themes.scss` : Classes de composants (buttons, forms) **FIXES**
- `_base.scss` : Reset CSS, √©l√©ments de base **FIXES**
- `_breakpoints.scss` : Media queries responsives **FIXES**

### Utilisation Correcte

```scss
// ‚úÖ Utilisez les variables existantes
.my-component {
  font-size: var(--font-size-m);
  color: var(--color-primary);
  padding: 1rem 2rem;
}

// ‚úÖ Utilisez les classes existantes
<button className="btn">Primary</button>
<button className="btn btn-secondary">Secondary</button>

// ‚ùå Ne cr√©ez pas de nouvelles variables de base
:root {
  --my-custom-color: #123456; // INTERDIT
}
```

## Authentification 2025 - **MISE √Ä JOUR**

- Email + mot de passe avec validation Yup
- OAuth2 Google et Facebook avec PKCE
- JWT avec refresh tokens s√©curis√©s (algorithme RS256)
- Gestion des profils utilisateur avec avatar
- **Redux Toolkit** pour la gestion de l'√©tat auth
- Support MFA (optionnel)

## Validation avec Yup - **NOUVEAU**

### Sch√©mas de Validation

```typescript
// src/utils/validation.ts
import * as yup from "yup";

export const loginSchema = yup.object({
  email: yup.string().email().required(),
  password: yup.string().min(8).required(),
});

export const workspaceSchema = yup.object({
  name: yup.string().min(3).max(50).required(),
  description: yup.string().max(200),
});
```

## Nouveaut√©s 2025

### Redux Toolkit Sp√©cifique

- **createSlice** pour reducers et actions automatiques
- **configureStore** avec middleware par d√©faut
- **RTK Query** pour les appels API (optionnel)
- **createAsyncThunk** pour la logique async
- Support TypeScript int√©gr√©

### Vitest + MSW Testing Stack

- Test runner ultra-rapide avec HMR
- MSW pour mocker les APIs en tests
- Interface UI pour debug interactif
- Couverture de code native avec V8
- Support ES modules natif

### React Router v7 Nouveaut√©s

- File-based routing am√©lior√©
- Nested routes optimization
- Better TypeScript support
- Enhanced data loading

### Node.js 22 LTS Avantages

- ES modules natifs sans flag
- Performance am√©lior√©e V8
- Nouveau test runner int√©gr√©
- Fetch API natif
- Support WebStreams

## Conseils pour Copilot 2025 - **MISE √Ä JOUR - CONVENTIONS VALID√âES**

1. **Toujours utiliser Redux Toolkit** au lieu de Context API pour l'√©tat global
2. **Utiliser les alias configur√©s** (@components, @store, @contexts, etc.)
3. **Privil√©gier Yup** pour la validation c√¥t√© client
4. **Utiliser Vitest + MSW** pour tous les tests
5. **Respecter la nouvelle structure modulaire** avec types/ et config/
6. **Utiliser les hooks Redux typ√©s** (useAppSelector, useAppDispatch)
7. **Documenter avec JSDoc + TypeScript** pour IntelliSense optimal
8. **Consid√©rer React Router v7** patterns pour la navigation
9. **Utiliser ES modules** natifs pour Node.js 22
10. **Int√©grer les bonnes pratiques s√©curit√© 2025**
11. **RESPECTER les fichiers SCSS existants** (\_variables.scss, \_themes.scss, etc.)
12. **DEMANDER CONFIRMATION** avant de lancer des tests
13. **UTILISER UNIQUEMENT Docker** pour toute ex√©cution avec les bons fichiers `.env.*`
14. **UTILISER les helpers de test valid√©s** (`renderWithProviders`, `TestProvider`, `MockSocketProvider`)
15. **TOUJOURS inclure l'alias @contexts** dans la configuration Vitest

### Patterns Redux Toolkit Recommand√©s

```typescript
// ‚úÖ Bon pattern avec RTK
const { data, isLoading, error } = useAppSelector((state) => state.auth);

// ‚úÖ Dispatch avec TypeScript
const dispatch = useAppDispatch();
dispatch(loginUser({ email, password }));

// ‚úÖ Slice avec immer
const slice = createSlice({
  name: "feature",
  initialState,
  reducers: {
    updateField: (state, action) => {
      state.field = action.payload; // Immer rend cela immutable
    },
  },
});
```

### Tests avec Vitest + MSW - **Patterns valid√©s**

```typescript
// ‚úÖ Test avec MSW et helpers valid√©s
import { renderWithProviders } from "@tests/test-utils";
import { server } from "@tests/mocks/server";
import { rest } from "msw";

beforeEach(() => {
  server.use(
    rest.get("/api/users", (req, res, ctx) => {
      return res(ctx.json([]));
    })
  );
});

test("Mon test", () => {
  const { getByText } = renderWithProviders(<MonComposant />);
  expect(getByText("Mon texte")).toBeInTheDocument();
});
```

### Gestion d'Erreurs Docker-Specific

```typescript
// ‚úÖ Pattern de v√©rification d'environnement Docker
if (!import.meta.env.VITE_API_URL) {
  console.error("Configuration Docker manquante: VITE_API_URL non d√©finie");
  throw new Error("Configuration Docker invalide");
}
```

## V√©rifications Obligatoires Avant G√©n√©ration de Code - **VALID√âES**

### Checklist Docker-First

1. ‚úÖ **V√©rifier que toute r√©f√©rence utilise le port 3000** (jamais 3001)
2. ‚úÖ **Confirmer l'usage de Docker Compose** pour tous les services avec bons fichiers `.env.*`
3. ‚úÖ **Utiliser uniquement les variables d'environnement officielles** :
   - `VITE_API_URL=http://localhost:3000/api`
   - `VITE_API_URL=http://localhost:3000`
4. ‚úÖ **Aucune commande manuelle** (npm, node) dans le code g√©n√©r√©
5. ‚úÖ **Architecture modulaire Redux Toolkit** respect√©e
6. ‚úÖ **Fichiers SCSS de base non modifi√©s** (\_variables.scss, \_themes.scss, etc.)
7. ‚úÖ **Tests uniquement via environnement Docker** existant avec `.env.test`
8. ‚úÖ **Utiliser les helpers de test valid√©s** avec mocks appropri√©s
9. ‚úÖ **Inclure l'alias @contexts** dans toute configuration Vitest

### Exemples de Code Docker-Compliant

#### Configuration API Frontend

```typescript
// ‚úÖ CORRECT - Utilise la config Docker
export const API_BASE_URL =
  import.meta.env.VITE_API_URL || "http://localhost:3000/api";
export const SOCKET_URL =
  import.meta.env.VITE_API_URL || "http://localhost:3000";

// ‚ùå INCORRECT - Port manuel non-Docker
export const API_BASE_URL = "http://localhost:3001/api"; // Mauvais port
```

#### Redux Toolkit Pattern

```typescript
// ‚úÖ CORRECT - Hooks typ√©s
const dispatch = useAppDispatch();
const { data, isLoading, error } = useAppSelector((state) => state.auth);

// ‚úÖ CORRECT - Slice avec createSlice
const slice = createSlice({
  name: "feature",
  initialState,
  reducers: {
    updateField: (state, action) => {
      state.field = action.payload; // Immer rend cela immutable
    },
  },
});
```

#### SCSS Patterns

```scss
// ‚úÖ CORRECT - Utilise les variables existantes
.my-component {
  font-size: var(--font-size-m);
  color: var(--color-primary);
  padding: 1rem 2rem;
}

// ‚úÖ CORRECT - Utilise les classes existantes
.btn // Classe d√©finie dans _themes.scss

// ‚ùå INCORRECT - Nouvelles variables interdites
:root {
  --my-new-color: #123456; // INTERDIT
}
```

#### Tests Pattern Valid√©

```typescript
// ‚úÖ CORRECT - Pattern de test valid√© avec tous les mocks
import { renderWithProviders } from "@tests/test-utils";
import { vi } from "vitest";

// Mock n√©cessaire si useSocket utilis√© directement
vi.mock("@hooks/useSocket", () => ({
  useSocket: () => ({
    socket: {
      id: "mock",
      connected: true,
      on: vi.fn(),
      off: vi.fn(),
      emit: vi.fn(),
    },
    connected: true,
    socketId: "mock",
  }),
}));

test("Mon composant", () => {
  const { getByText } = renderWithProviders(<MonComposant />);
  expect(getByText("Texte attendu")).toBeInTheDocument();
});
```

## **CONFIGURATION FINALE VALID√âE - R√âSUM√â EX√âCUTIF**

### ‚úÖ **TESTS FRONTEND : 112/112 R√âUSSIS**

- ‚úÖ **Environnement Docker test** : `docker compose -f docker-compose.test.yml --env-file .env.test`
- ‚úÖ **Configuration Vitest** : Alias `@contexts` ajout√© et requis
- ‚úÖ **Helpers de test** : `renderWithProviders`, `TestProvider`, `MockSocketProvider` valid√©s
- ‚úÖ **Mocks** : `useSocket` hook mock√© globalement pour tous les tests
- ‚úÖ **Architecture** : Redux Toolkit + Vitest + MSW enti√®rement op√©rationnels

### ‚úÖ **CONVENTIONS OBLIGATOIRES VALID√âES**

1. **Fichiers d'environnement** : Multiples `.env.*` √† la racine selon l'environnement
2. **Tests Docker-first** : Toujours avec le bon fichier `.env.test`
3. **Alias TypeScript** : `@contexts` requis pour les tests
4. **Helpers de test** : Configuration finale valid√©e et op√©rationnelle
5. **Mocks** : Pattern useSocket mock√© globalement valid√©

### ‚ö†Ô∏è **RAPPELS CRITIQUES**

- **JAMAIS** de fichiers `.env` dans les sous-dossiers `web/`, `api/`, `mobile/`
- **TOUJOURS** utiliser Docker Compose avec le bon fichier `.env.*`
- **OBLIGATOIRE** : Alias `@contexts` dans toute configuration Vitest
- **REQUIS** : Helpers de test valid√©s pour tous nouveaux tests
- **INTERDIT** : Modification des fichiers SCSS de base

---

_Cette documentation refl√®te l'√©tat final valid√© apr√®s r√©solution compl√®te des 112 tests frontend avec succ√®s._
